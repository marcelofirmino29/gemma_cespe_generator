{% extends 'generator/base.html' %}
{% load static %}

{% block title %}Gerador MCQ (FGV) - Gerador IA{% endblock title %}

{% block extra_head %}
    {# Estilos similares aos outros geradores #}
    <link rel="stylesheet" href="{% static 'generator/css/exam_generator_styles.css' %}">
    <style>
        .nav-tabs .nav-link { /* ... estilos das abas ... */ }
        .nav-tabs .nav-link.active { /* ... */ }
        .content-container { /* ... estilos do container ... */ }
        label { display: block; margin-bottom: 0.25rem; }
        .form-label { font-size: 0.85rem; margin-bottom: 0.3rem; }
        .form-control, .form-select { font-size: 0.9rem; }
        .form-text { font-size: 0.75rem; width: 100%; }
        #ai-raw-response-mcq {
            white-space: pre-wrap;
            word-wrap: break-word;
            background-color: var(--bs-tertiary-bg);
            padding: 1rem;
            border-radius: 0.375rem;
            border: 1px solid var(--bs-border-color);
            font-size: 0.85em;
            max-height: 70vh;
            overflow-y: auto;
        }
    </style>
{% endblock extra_head %}

{% block content %}

    {# Mensagens #}
    {% if not service_initialized %} <div class="alert alert-danger">... Serviço indisponível ...</div> {% endif %}
    {% if messages %}{% for message in messages %}<div class="alert alert-{% if message.tags %}{{ message.tags }}{% else %}info{% endif %} alert-dismissible fade show small mb-3"> {{ message }} <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button></div>{% endfor %}{% endif %}

    {# Abas de Navegação #}
    <ul class="nav nav-tabs mb-0" id="mainTabs" role="tablist">
       <li class="nav-item" role="presentation"> <a class="nav-link" href="{% url 'generator:generate_questions' %}">Gerador C/E</a> </li>
       <li class="nav-item" role="presentation"> <a class="nav-link" href="{% url 'generator:generate_discursive_exam' %}">Gerador Discursiva</a> </li>
       {# Aba ativa para MCQ FGV #}
       <li class="nav-item" role="presentation"> <button class="nav-link active" id="mcq-fgv-tab" data-bs-toggle="tab" data-bs-target="#mcq-fgv-panel" type="button" role="tab" aria-controls="mcq-fgv-panel" aria-selected="true">Gerador MCQ (FGV)</button> </li>
       <li class="nav-item" role="presentation"> <a class="nav-link" href="{% url 'generator:configurar_simulado' %}">Configurar Simulado</a> </li>
       <li class="nav-item" role="presentation"> <a class="nav-link" href="{% url 'generator:dashboard' %}">Meu Desempenho</a> </li>
       <li class="nav-item" role="presentation"> <a class="nav-link" href="{% url 'generator:games_hub' %}">Hub de Jogos</a> </li>
       <li class="nav-item" role="presentation"> <a class="nav-link" href="{% url 'generator:ask_ai' %}">Pergunte à IA</a> </li>
    </ul>

    {# Container Principal #}
    <div class="tab-content" id="mainTabsContent">
      <div class="tab-pane fade show active" id="mcq-fgv-panel" role="tabpanel" aria-labelledby="mcq-fgv-tab">
        <div class="content-container shadow-sm">

            {# Formulário #}
            <div class="mb-4">
                <h1 class="h5 mb-3 fw-normal">Gerar Questões Múltipla Escolha (Estilo FGV)</h1>
                <form method="post" action="{% url 'generator:generate_mcq_fgv' %}" id="mcq-fgv-form" {% if not service_initialized %} style="opacity: 0.6; pointer-events: none;" {% endif %}>
                    {% csrf_token %}
                    <div class="row g-4"> {# Linha principal do formulário #}
                        {# Coluna Esquerda: Tópico/Contexto #}
                        <div class="col-md-7 col-lg-8">
                            <div class="mb-3">
                                <label for="{{ form.topic.id_for_label }}" class="form-label small fw-medium">{{ form.topic.label }}</label>
                                {{ form.topic }}
                                {% if form.topic.help_text %}<div class="form-text text-muted small">{{ form.topic.help_text|safe }}</div>{% endif %}
                                {% if form.topic.errors %}<div class="invalid-feedback d-block">{{ form.topic.errors|striptags }}</div>{% endif %}
                            </div>
                        </div>
                        {# Coluna Direita: Opções #}
                        <div class="col-md-5 col-lg-4">
                            <div class="mb-3"><label for="{{ form.num_questions.id_for_label }}" class="form-label small fw-medium">{{ form.num_questions.label }}</label>{{ form.num_questions }}{% if form.num_questions.help_text %}<div class="form-text text-muted small">{{ form.num_questions.help_text|safe }}</div>{% endif %}{% if form.num_questions.errors %}<div class="invalid-feedback d-block">{{ form.num_questions.errors|striptags }}</div>{% endif %}</div>
                            <div class="mb-3"><label for="{{ form.difficulty_level.id_for_label }}" class="form-label small fw-medium">{{ form.difficulty_level.label }}</label>{{ form.difficulty_level }}{% if form.difficulty_level.errors %}<div class="invalid-feedback d-block">{{ form.difficulty_level.errors|striptags }}</div>{% endif %}</div>
                            <div class="mb-3"><label for="{{ form.area.id_for_label }}" class="form-label small fw-medium">{{ form.area.label }}</label>{{ form.area }}{% if form.area.errors %}<div class="invalid-feedback d-block">{{ form.area.errors|striptags }}</div>{% endif %}</div>
                            {# Botões #}
                            <div class="mt-4 d-flex gap-2">
                                <button type="button" class="btn btn-outline-secondary btn-sm" onclick="document.getElementById('mcq-fgv-form').reset();">Limpar</button>
                                <button type="submit" class="btn btn-primary btn-sm flex-grow-1" id="submit-mcq-fgv"><span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true" id="loading-spinner-mcq"></span><span id="button-text-mcq">Gerar Questões MCQ</span></button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>

            {# Exibição de Erro Geral de Geração #}
            {% if error_message and service_initialized and not form.errors %}
                <div class="alert alert-danger alert-dismissible fade show small" role="alert">
                     <strong>Erro ao Gerar:</strong> {{ error_message }}
                     <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endif %}

            {# Exibição da Resposta Bruta da IA #}
            {% if ai_raw_response %}
                <hr class="my-4">
                <div>
                    <h2 class="h5 mb-3 fw-normal">Resultado Bruto da IA:</h2>
                    <pre id="ai-raw-response-mcq"><code>{{ ai_raw_response }}</code></pre>
                </div>
            {% endif %}

        </div> {# Fim content-container #}
      </div> {# Fim tab-pane #}
    </div> {# Fim tab-content #}

{% endblock content %}

{% block extra_js %}
    {# Script para mostrar spinner no botão (similar a question_generator_scripts.js) #}
    <script>
        const formMCQ = document.getElementById('mcq-fgv-form');
        const submitButtonMCQ = document.getElementById('submit-mcq-fgv');
        const spinnerMCQ = document.getElementById('loading-spinner-mcq');
        const buttonTextMCQ = document.getElementById('button-text-mcq');

        if(formMCQ && submitButtonMCQ && spinnerMCQ && buttonTextMCQ){
            formMCQ.addEventListener('submit', function() {
                // Mostra o spinner e desabilita o botão
                spinnerMCQ.classList.remove('d-none');
                buttonTextMCQ.textContent = 'Gerando...'; // Muda o texto
                submitButtonMCQ.disabled = true;
            });
        }
    </script>
{% endblock extra_js %}